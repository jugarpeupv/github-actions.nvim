# Repository Guidelines

## Project Structure & Module Organization
- `lua/github-actions/` holds plugin modules; `parser/workflow.lua` parses workflow YAML into structured results.
- `spec/` contains Busted specs, helper shims, and fixtures; load `spec/minimal_init.lua` to bootstrap Neovim APIs.
- `docs/` provides design notes; `github-actions.nvim-scm-1.rockspec` and `./luarocks` manage dependencies.
- `lua_modules/` is generated by Luarocks; runtime entrypoints belong under `plugin/` or `ftplugin/` if future features need them.

## Build, Test, and Development Commands
- `make test` — exports the local Luarocks path and runs the full Busted suite via `./luarocks test`.
- `make test-file FILE=spec/parser_spec.lua` — executes a single spec file; pass any path under `spec/`.
- `make lint` — runs `selene` or `luacheck` over `lua/`, failing if neither is installed.
- `make format` / `make check` — apply or verify Stylua formatting across `lua/` and `spec/`.
- Manual run: `./luarocks busted spec/parser_spec.lua` mirrors CI without invoking `make`.

## Coding Style & Naming Conventions
- Stylua enforces 2-space indentation, Unix line endings, 120-character width, and prefers single quotes (`stylua.toml`).
- Match module paths to directory layout (`require('github-actions.parser.workflow')`); keep filenames lowercase with hyphen-free names.
- Use descriptive locals and table-driven fixtures; keep Neovim API calls wrapped in helpers under `spec/helpers/` or future `lua/github-actions/util/`.

## Testing Guidelines
- Tests use Busted with the shim in `spec/minimal_init.lua`; require it at the top of every new spec.
- Name specs `*_spec.lua` and store workflow samples in `spec/fixtures/` for reuse.
- Cover edge cases for version tags, hashes, and comments similar to `parser_spec.lua`.
- Run `make test` before pushing; add targeted specs for regressions and new parser behavior.

## Commit & Pull Request Guidelines
- Favor short, imperative subjects (`Add parser caching`); expand details in the body with bullet summaries or issue IDs (`Refs #12`).
- Group related changes per commit; avoid mixing formatting and functional updates.
- PRs should describe behavior changes, list commands run (e.g., `make test`, `make check`), and attach GIFs or screenshots when virtual text output changes.
- Ensure CI passes and request reviews with outstanding questions called out explicitly.

## Environment & Tooling
- Develop against Neovim 0.9+, Luarocks, Stylua, the GitHub CLI (`gh`), and the Treesitter YAML parser.
- Use `./luarocks path --no-bin` before manual commands to mirror the Makefile environment.
- Keep machine-specific config out of version control; rely on `lua_modules/` for local dependencies.
